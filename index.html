<html>
<head>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"></link>
	<link href="reboot.css"></link>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Audiowide"></link>
	<!--<script src="data.js"></script>-->
	<style>
		body {
		  font-family: "Audiowide", sans-serif;
		  background-color: lightgray;
		}
		
		span.label{
			font-style: italic;
			font-weight: bolder;
			font-size: larger;
		}

		.modal-body{
			background-color: gray;
		}

		.card{
			height: 95%;
		}

		.card-img-top{
			height: auto;
		}

		.btn-primary-add{
			background-color: blue;
		}
	</style>
</head>
<body>
	<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	<h1 style="float: none; position: relative; text-align: center; color: black;">
		Available Pets
	</h1>
	<div id="new-pet" class="new-pet-container">
			<input type="text" name="name" class="form-control"  placeholder="Name of the pet" />
			<select name="type" class="form-control" placeholder="Type of pet">
				<option value="Dog">Dog</option>
				<option value="Cat">Cat</option>
				<option value="Other">Other</option></select>
			<input type="file" name="image" class="form-control" placeholder="Image of the pet"/>
			<input type="text" name="breed" class="form-control" placeholder="Breed of the pet"/>
			<select name="sex" class="form-control" placeholder="Sex of the pet">
				<option value="Female">Female</option>
				<option value="Male">Male</option></select>
			<input type="text" name="color" class="form-control" placeholder="Color of the pet"/>
			<select name="fixed" class="form-control" placeholder="Fixed status of the pet">
				<option value="Yes">Yes</option>
				<option value="No">No</option></select>
			<input type="number" name="age" class="form-control" placeholder="Age of the pet"/>
			<input type="number" name="animal_id" class="form-control" placeholder="Animal id of the pet"/>
			<input type="number" name="microchip_num" class="form-control" placeholder="Microchip number of the pet"/>
			<!-- <input type="checkbox" name="status" value="Health" class="form-check-input" id="status-health">
			<label class="form-check-label" for="status-health">Health checked</label><br>
			<input type="checkbox" name="status" value="Vaccinations" class="form-check-input" id="status-vaccinations">
			<label class="form-check-label" for="status-vaccinations">Vaccinations up to date</label><br>
			<input type="checkbox" name="status" value="Wormed" class="form-check-input" id="status-worms">
			<label class="form-check-label" for="status-womrs">Regularly dewormed</label><br>
			<input type="checkbox" name="status" value="Chipped" class="form-check-input" id="status-check">
			<label class="form-check-label" for="status-check">Microchipped</label><br>
			<input type="checkbox" name="status" value="Unhealth" class="form-check-input" id="status-unhealth">
			<label class="form-check-label" for="status-unhealth">Health not checked</label><br>
			<input type="checkbox" name="status" value="Vaccination" class="form-check-input" id="status-vaccination">
			<label class="form-check-label" for="status-vaccination">Vaccinations not up to date</label><br> -->
			<textarea name="status" class="form-control" placeholder="Status of the pet"></textarea>
			<textarea name="about_me" class="form-control" placeholder="More details of the pet"></textarea>
		<button class="btn btn-primary-add">Add a new pet</button>

	</div>
	<div class="container">
		<div class="row" id="pet_container">	
		</div>
	</div>
	<div id="morepets" class="morepets">
	</div>
	<div id="modal" class="modal" tabindex="-1">
		<div class="modal-dialog" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="pet_name"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modal_body">
                <ul>
					<li id="description_pet"><p></p></li>
					<li id="pet_type"><p></p></li>
					<li id="pet_breed"><p></p></li>
                    <li id="pet_sex"><p></p></li>
                    <li id="spayed_or_neutered_pet"><p></p></li>
					<li id="pet_age"><p></p></li>
                    <li id="status_pet"><p></p></li>
                </ul>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" >
                    <a id="go_to_details_page" style="color: white; text-decoration: none;">
                        More information
                    </a>
                </button>
                <button id="closeModal" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
            </div>
        </div>
	</div>


	<div id="edit-modal" class="modal" tabindex="-1">
		<div class="modal-dialog" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="edit_pet_name"></h5>
            </div>
            <div class="modal-body" id="edit-modal_body">
				<form>
					<ul class="list-group" id="edit_pet_list">
						<li><p>Name: <input type="text" id="name"></input></p></li>
						<li><p>Type: <select name="type" id="type">
							<option value="Dog">Dog</option>
							<option value="Cat">Cat</option>
							<option value="Other">Other</option></p></select>
						</li>
						<li><p>Breed: <input type="text" id="breed"></input></p></li>
						<li><p>Sex: <select name="sex" id="sex">
							<option value="Female">Female</option>
							<option value="Male">Male</option></p></select>
						</li>
						<li><p>Spayed/Neutered: <select name="fixed" id="fixed">
							<option value="Yes">Yes</option>
							<option value="No">No</option></p></select>
						</li>
						<li><p>Age: <input type="text" id="age"></input></p></li>
						<li><p>Status:</p></p><p id="status"></p>
							<div class="text-end">
								<button id="add_another_status" class="btn btn-sm btn-primary">+</button>
							</div></li>
					</ul>
				</form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" >
                    <a id="btn-save-changes" style="color: white; text-decoration: none;">
                       Save Changes
                    </a>
                </button>
                <button id="closeModal" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
            </div>
        </div>
	</div>


	<script src="Functions.js"></script>
	<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script>
		let document_url = "https://jsonblob.com/api/jsonBlob/1211400843529412608";
		var petarray=  '';
		document.addEventListener("DOMContentLoaded", function() {
			$.get(document_url, function(data, status){
			petarray = data;
			for (let i=offset; i < Math.min(offset+rpp, data.length); i++){
				pet_card(data[i], i);
			}
      		});
		});

		let more_pets = document.createElement('button');
		more_pets.classList.add('btn');
		more_pets.classList.add('btn-primary');
		more_pets.innerText='View more pets!';
		more_pets.addEventListener('click', function() {
			offset+=9;
			for (let i=offset; i < Math.min(offset+rpp, petarray.length); i++){
				pet_card(petarray[i], i);
			}
		});
		document.querySelector('#morepets').append(more_pets);

		$(()=>{
			let editIsOpened = false;
			let index_num;
			
			$(document).on('click','#pet_container .card', function(){
				if (!editIsOpened){
					const card = $(this).parent().data('index');	
					if (card !== null && card !== undefined){
						showModal(card);
						$('#modal').modal('show');
					}
				}
			});

			$(document).on('click','#closeModal', function(){
				$('#modal').modal('hide');
				$('#edit-modal').modal('hide');
				editIsOpened = false;
			});

			$(document).on('click', '.btn-edit-pet', function(event){
				event.stopPropagation();
				editIsOpened = true;
				index_num = $(this).parent().parent().parent().data('index');
				$("#name").val(petarray[index_num].name);
				$("#type").val(petarray[index_num].type);
				$("#breed").val(petarray[index_num].breed);
				$("#sex").val(petarray[index_num].sex);
				$("#fixed").val(petarray[index_num].fixed);
				$("#age").val(petarray[index_num].age);
				console.log($("input[name='name']").val());
				
				$('#status').empty();
				for(let i=0; i<petarray[index_num].status.length; i++){
					$('#status').append(`<input type="text" id="status-${i}" value="${petarray[index_num].status[i]}"/>
											<button class="delete_a_status btn btn-sm btn-primary">-</button>`);
				}
				$('#edit-modal').modal('show');
			});

			$(document).on('click','#btn-save-changes', function(){
				if (index_num !== undefined && index_num !== null){
					petarray[index_num].name = $("#name").val();
					petarray[index_num].type = $("#type").val();
					petarray[index_num].breed = $("#breed").val();
					petarray[index_num].sex = $("#sex").val();
					petarray[index_num].fixed = $("#fixed").val();
					petarray[index_num].age = $("#age").val();
					for (let i=0; i < petarray[index_num].status.length; i++ ){
						petarray[index_num].status[i] = $(`#status-${i}`).val();
					}

					updateCard(index_num);
					console.log(petarray[0]);

					$.ajax({
					type: "PUT",
					url: "https://jsonblob.com/api/jsonBlob/1077296012858769408",
					data: JSON.stringify({"content":"here"}),
					contentType: "application/json; charset=utf-8",
					dataType: "json",
					success: function(xhr,data,response){
						console.log(xhr);
						console.log(data);
						console.log(response);
						console.log(response.getAllResponseHeaders());
					},
					error: function(errMsg) {
						alert(errMsg);
					}
				});

					$('#edit-modal').modal('hide');
					editIsOpened = false;
				}
			});

			$(document).on('click', '#add_another_status', function(event){
				let i = petarray[index_num].status.length;
				event.stopPropagation();
				event.preventDefault();
				let newStatusInput = $(`<input type="text" id="status-${i}" />
										<button class="delete_a_status btn btn-sm btn-primary">-</button>`);
				$('#status').append(newStatusInput);
				petarray[index_num].status.push(newStatusInput.val());
			});

			$(document).on('click', '.delete_a_status', function(event){
				event.stopPropagation();
				event.preventDefault();
				$(this).prev().remove();
				$(this).remove();
			});

			$(document).on('click','.btn-primary-add',function(){
				try{
				// let selectedStatus=[];
				// $('input[name="status"]:checked').each(function() {
        		// 	selectedStatus.push($(this).val());
    			// });

				let pet={
                    name:$('[name=name]').val(),
                    type:$('[name=type]').val(),
					image:$('[name=image]').val(),
                    breed:$('[name=breed]').val(),
					sex:$('[name=sex]').val(),
                    color:$('[name=color]').val(),
					fixed:$('[name=fixed]').val(),
                    age:$('[name=age]').val(),
					animal_id:$('[name=animal_id]').val(),
                    microchip_num:$('[name=microchip_num]').val(),
					status:$('[name=status]').val(),
                    about_me:$('[name=about_me]').val()
                    };
					
                    pets.push(pet);
					// pet_card(pet);
					pet_card(pet, petarray.length);
					console.log(petarray);


					$.ajax({
					type: "PUT",
					url: "https://jsonblob.com/api/jsonBlob/1077296012858769408",
					data: JSON.stringify({}),
					contentType: "application/json; charset=utf-8",
					dataType: "json",
					success: function(xhr,data,response){
						console.log(xhr);
						console.log(data);
						console.log(response);
						console.log(response.getAllResponseHeaders());
					},
					error: function(errMsg) {
						alert(errMsg);
					}
				});

					
				} catch(error){
					console.error("Error in adding:", error);
				}
					
                });
		
		});

		$(document).on('click', '.btn-danger', function(event) {
			event.stopPropagation();
			console.log($(this))
			const index = parseInt($(this).attr('data-index'));
			console.log(index);
			pets[index]={};
			console.log(pets);
			$(this).closest('.col-lg-4').remove();
		});
	</script>
</body>
</html>